# Руководство по обеспечению непрерывной работы бота 24/7

## Введение

Данное руководство описывает инфраструктуру для обеспечения непрерывной работы Telegram бота 24/7 на платформе Replit с использованием Reserved VM. Система включает в себя следующие компоненты:

1. **Основной бот** - обрабатывает сообщения пользователей и взаимодействует с Telegram API
2. **Веб-приложение** - предоставляет интерфейс для мониторинга состояния бота
3. **Мониторинг** - отслеживает работоспособность бота и перезапускает его при необходимости
4. **Система автовосстановления** - обеспечивает автоматический перезапуск всей инфраструктуры в случае сбоев

## Компоненты системы

### Основные скрипты

| Скрипт | Описание |
|--------|----------|
| `start_24_7.sh` | Главный скрипт для запуска всей инфраструктуры непрерывной работы |
| `run_24_7.sh` | Управляет запуском всех компонентов с автоперезапуском |
| `auto_recovery.py` | Система мониторинга и автоматического восстановления |
| `bot_monitor.py` | Мониторинг состояния бота и его перезапуск |
| `keep_alive.py` | Предотвращает "засыпание" Replit |

### Файлы здоровья и мониторинга

| Файл | Описание |
|------|----------|
| `bot_health.txt` | Файл для отслеживания активности бота |
| `logs/` | Директория с логами всех компонентов |

## Запуск системы

Для запуска бота в режиме непрерывной работы 24/7 используйте следующую команду:

```bash
bash start_24_7.sh
```

Этот скрипт выполнит следующие действия:

1. Остановит все существующие процессы бота и мониторинга
2. Запустит основной скрипт непрерывной работы `run_24_7.sh`
3. Запустит систему автовосстановления `auto_recovery.py`
4. Проверит запуск всех компонентов

## Мониторинг состояния

### Через веб-интерфейс

Вы можете мониторить состояние бота через веб-интерфейс, доступный по адресу:
- [https://your-replit-url](https://your-replit-url)

Веб-интерфейс предоставляет информацию о:
- Общем состоянии бота (запущен/остановлен)
- Использовании системных ресурсов
- Последних логах и ошибках

### Через файловую систему

Для проверки состояния через файловую систему:

1. Просмотр логов всех компонентов:
   ```bash
   ls -l logs/
   ```

2. Проверка файла здоровья:
   ```bash
   cat bot_health.txt
   ```

3. Проверка запущенных процессов:
   ```bash
   ps aux | grep python
   ```

## Устранение неполадок

### Проблема: Бот не отвечает на сообщения

1. Проверьте, запущены ли все необходимые процессы:
   ```bash
   ps aux | grep python
   ```

2. Проверьте последние логи на наличие ошибок:
   ```bash
   tail -n 50 logs/bot_runner_*.log
   ```

3. Перезапустите всю систему:
   ```bash
   bash start_24_7.sh
   ```

### Проблема: Система автовосстановления не работает

1. Проверьте логи системы автовосстановления:
   ```bash
   tail -n 50 logs/auto_recovery_output.log
   ```

2. Проверьте права доступа на скрипты:
   ```bash
   chmod +x *.sh *.py
   ```

3. Запустите систему автовосстановления вручную:
   ```bash
   python auto_recovery.py
   ```

## Обслуживание системы

### Обновление скриптов мониторинга

При обновлении скриптов мониторинга рекомендуется:

1. Остановить текущую систему:
   ```bash
   pkill -f "python.*main.py"
   pkill -f "python.*bot_monitor.py"
   pkill -f "python.*auto_recovery.py"
   pkill -f "bash.*run_24_7.sh"
   ```

2. Внести необходимые изменения в скрипты

3. Перезапустить систему:
   ```bash
   bash start_24_7.sh
   ```

### Резервное копирование логов

Для предотвращения переполнения диска логами рекомендуется периодически архивировать и очищать старые логи:

```bash
mkdir -p logs_archive
tar -czf logs_archive/logs_$(date +%Y%m%d).tar.gz logs/
find logs/ -type f -mtime +7 -delete
```

## Заключение

Внедренная система обеспечивает надежную работу бота 24/7 на платформе Replit с использованием Reserved VM. Система автоматически восстанавливается при сбоях и поддерживает постоянную работоспособность бота.

При возникновении вопросов обращайтесь к документации или разработчикам проекта.