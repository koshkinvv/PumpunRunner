# Руководство по интеграции улучшенного генератора тренировочных планов

## Обзор изменений

Созданный модуль `coach_prompt_integration.py` представляет собой улучшенную версию генератора тренировочных планов, использующую передовые методики из ключевых книг по беговым тренировкам. Модуль позволяет создавать более персонализированные и научно-обоснованные планы тренировок для бегунов всех уровней.

## Особенности нового модуля

1. **Расширенная база знаний**
   - Использование методик Jack Daniels из книги "Training Distance Runners"
   - Принципы Steve Magness из книги "Science of Running"
   - Система периодизации Tudor Bompa из книги "Periodization Training for Sports"
   - Подходы к восстановлению от Brad Stulberg и Steve Magness из книги "Peak Performance"
   - Комплексный подход David Joyce из книги "High-Performance Training for Sports"

2. **Улучшенный промпт для OpenAI GPT-4o**
   - Более детальный системный промпт с акцентами на научных принципах
   - Структурированный пользовательский промпт для точной передачи профиля бегуна
   - Четкие инструкции для формирования плана тренировок в JSON-формате

3. **Гибкий расчет дат тренировок**
   - Учет предпочитаемых дней тренировок пользователя
   - Автоматический расчет оптимальных дат на основе дня начала тренировок
   - Адаптация к желаемой частоте тренировок в неделю

4. **Улучшенная обработка ошибок**
   - Запасной вариант генерации плана в случае проблем с основным методом
   - Подробное логирование для диагностики и отладки
   - Защита от некорректных входных данных

## Интеграция с существующим ботом

### Шаг 1: Установка модуля

Скопируйте файл `coach_prompt_integration.py` в корневую директорию проекта.

### Шаг 2: Импорт и использование функции в тренировочном модуле

Найдите в файле `openai_service.py` метод `generate_training_plan` и добавьте интеграцию с новым генератором:

```python
from coach_prompt_integration import generate_improved_training_plan

def generate_training_plan(self, runner_profile):
    """
    Generate a personalized running training plan based on runner profile.
    
    Args:
        runner_profile: Dictionary containing runner profile information
        
    Returns:
        Dictionary containing training plan for 7 days
    """
    try:
        # Пробуем использовать новый улучшенный генератор
        improved_plan = generate_improved_training_plan(runner_profile)
        if improved_plan:
            logging.info("План успешно сгенерирован с помощью улучшенного промпта")
            return improved_plan
            
        # Если улучшенный генератор не сработал, используем существующий код
        logging.info("Используем стандартный метод генерации плана")
        
        # Далее оставьте существующий код без изменений
        # ...
    except Exception as e:
        logging.error(f"Error generating training plan: {e}")
        raise
```

### Шаг 3: Настройка системы логирования

Убедитесь, что директория `logs` существует и доступна для записи:

```python
import os
os.makedirs('logs', exist_ok=True)
```

### Шаг 4: Тестирование

Перед полной интеграцией рекомендуется протестировать новый генератор отдельно:

```
python coach_prompt_integration.py
```

Это создаст тестовый план на основе примера профиля бегуна и сохранит его в JSON-файл.

## Дополнительные возможности

### Интеграция с расширенными функциями

Улучшенный генератор включает поддержку:

1. **Подробных рекомендаций по питанию и восстановлению**
   - Добавьте отображение этих рекомендаций в сообщения бота

2. **Метаданных о генерации плана**
   - Используйте поле `generated_with` для отслеживания версии генератора
   - Поле `generated_at` содержит точное время создания плана

3. **Информации о рассчитанных датах тренировок**
   - Для отладки или дополнительного отображения используйте поле `training_dates_info`

### Улучшение производительности

При необходимости можно сократить время ожидания ответа от API, уменьшив объем промпта:

1. Используйте метод `get_basic_system_prompt()` вместо `get_expert_system_prompt()`
2. Упростите пользовательский промпт, убрав менее важные поля

## Рекомендации по развитию

1. **Добавление поддержки "продолжения тренировок"**
   - Создайте функцию, которая принимает предыдущий план и статус выполнения тренировок
   - Передавайте эту информацию в промпт для создания логического продолжения

2. **Интеграция шаблонных тренировок для разных целей**
   - Добавьте библиотеку типовых тренировок для марафона, полумарафона и т.д.
   - Включите их в системный промпт для лучшей специализации

3. **Расчет нагрузки и управление прогрессией**
   - Добавьте функции для анализа выполненных тренировок
   - Используйте данные о выполнении для корректировки будущих планов