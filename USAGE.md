# Инструкция по запуску Telegram бота для бегунов

## Важные требования к окружению

### Использование Reserved VM

Для стабильной работы бота **настоятельно рекомендуется** использовать Reserved VM:

1. Reserved VM предотвращает "засыпание" проекта, которое может происходить с обычными Replit проектами
2. Обеспечивает стабильное выполнение в течение длительного времени
3. Гарантирует, что бот будет доступен 24/7

Если проект запущен на обычной VM, она может "заснуть" после периода неактивности, что приведет к отключению бота. Даже с системой мониторинга в этом случае бот не сможет перезапуститься, пока VM снова не "проснется".

### Альтернатива для обычной VM (без Reserve)

Если вы используете обычную (не Reserved) VM, можно попробовать использовать скрипт `keep_alive.py`:

```bash
nohup python keep_alive.py > keep_alive.log 2>&1 &
```

Этот скрипт:
1. Периодически выполняет ping веб-приложения для поддержания активности
2. Проверяет состояние бота и перезапускает его при необходимости
3. Выполняет случайные системные действия для предотвращения "засыпания"

Обратите внимание, что эта альтернатива **не гарантирует** такой же уровень стабильности, как Reserved VM, и может привести к периодическим отключениям бота.

## Основные компоненты системы

1. **main.py** - Основной файл бота, который содержит логику работы с Telegram API
2. **bot_monitor.py** - Скрипт мониторинга здоровья бота, который следит за работой бота и перезапускает его при необходимости
3. **start_bot_with_monitor.py** - Скрипт запуска бота вместе с монитором, который гарантирует, что оба компонента запущены
4. **run.py** - Самый простой способ запустить всю систему

## Как запустить бота

### Рекомендуемый способ

Используйте скрипт `run.py`, который настроит всю систему автоматически:

```bash
python run.py
```

Этот скрипт:
1. Создаст необходимые директории для логов
2. Запустит бота и монитор здоровья
3. Настроит автоматическое восстановление при сбоях
4. Сохранит все логи в директории `logs`

### Альтернативные способы запуска

Если вам нужно запустить только бота без мониторинга:

```bash
python main.py
```

Если вам нужно запустить бота с монитором:

```bash
python start_bot_with_monitor.py
```

## Система мониторинга и стабильности

Бот оснащен многоуровневой системой обеспечения стабильности:

1. **Мониторинг здоровья**: Каждые 30 секунд проверяется активность бота
2. **Мониторинг ресурсов**: Отслеживается использование памяти и CPU для выявления утечек
3. **Автоматический перезапуск**: При сбоях бот автоматически перезапускается
4. **Экспоненциальная задержка**: Для избежания циклических перезапусков используется постепенно увеличивающаяся задержка
5. **Логирование**: Все события и ошибки подробно логируются для диагностики

## Логи

Все логи сохраняются в директории `logs` и имеют префиксы:

- `bot_` - логи самого бота
- `monitor_` - логи монитора здоровья
- `launcher_` - логи скрипта запуска

К каждому файлу логов добавляется временная метка, чтобы не перезаписывать старые логи.

## Проверка состояния

Чтобы убедиться, что бот работает:

1. Проверьте наличие файла `bot_health.txt` с актуальной датой
2. Проверьте активные процессы командой `ps aux | grep python`

## Решение проблем

Если бот не запускается:

1. Проверьте логи в директории `logs`
2. Убедитесь, что переменные окружения настроены правильно
3. Проверьте доступность Telegram API
4. Проверьте свободное место на диске и доступную память

## Завершение работы

Для корректного завершения работы бота используйте сигнал прерывания (Ctrl+C) при запуске через `run.py`.