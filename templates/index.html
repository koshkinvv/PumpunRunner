<!DOCTYPE html>
<html lang="ru" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RunnerBot - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <style>
        .log-entry {
            margin-bottom: 5px;
            padding: 8px;
            border-radius: 4px;
        }
        .log-entry.INFO {
            background-color: rgba(25, 135, 84, 0.1);
        }
        .log-entry.WARNING {
            background-color: rgba(255, 193, 7, 0.1);
        }
        .log-entry.ERROR {
            background-color: rgba(220, 53, 69, 0.1);
        }
        .status-badge {
            font-size: 0.9rem;
        }
        .log-container {
            max-height: 500px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="row mb-4">
            <div class="col">
                <h1 class="display-5">üèÉ‚Äç‚ôÇÔ∏è RunnerBot - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
                <p class="lead">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Telegram –±–æ—Ç–æ–º –¥–ª—è –±–µ–≥—É–Ω–æ–≤</p>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card mb-3">
                    <div class="card-header">
                        <h5 class="card-title mb-0">–°—Ç–∞—Ç—É—Å –±–æ—Ç–∞</h5>
                    </div>
                    <div class="card-body">
                        {% if bot_status.running %}
                            <div class="d-flex align-items-center mb-3">
                                <div class="me-3">
                                    <span class="badge bg-success rounded-pill p-2">
                                        <span class="spinner-grow spinner-grow-sm" role="status"></span>
                                        –ó–∞–ø—É—â–µ–Ω
                                    </span>
                                </div>
                                <div>–ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã.</div>
                            </div>
                        {% else %}
                            <div class="d-flex align-items-center mb-3">
                                <div class="me-3">
                                    <span class="badge bg-danger rounded-pill p-2">–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span>
                                </div>
                                <div>–ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç.</div>
                            </div>
                        {% endif %}

                        {% if bot_status.last_start %}
                            <p class="text-muted small mb-1">–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫:</p>
                            <p class="mb-3">{{ bot_status.last_start }}</p>
                        {% endif %}

                        {% if bot_status.last_error %}
                            <div class="alert alert-danger p-2 mb-3">
                                <strong>–û—à–∏–±–∫–∞:</strong> {{ bot_status.last_error }}
                            </div>
                        {% endif %}

                        <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                            <button class="btn btn-primary btn-sm" id="startBtn" 
                                    {% if bot_status.running %}disabled{% endif %}>–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                            <button class="btn btn-warning btn-sm" id="restartBtn">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
                            <button class="btn btn-danger btn-sm" id="stopBtn"
                                    {% if not bot_status.running %}disabled{% endif %}>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                TELEGRAM_TOKEN
                                {% if env_vars.TELEGRAM_TOKEN %}
                                    <span class="badge bg-success rounded-pill">‚úì</span>
                                {% else %}
                                    <span class="badge bg-danger rounded-pill">‚úó</span>
                                {% endif %}
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                DATABASE_URL
                                {% if env_vars.DATABASE_URL %}
                                    <span class="badge bg-success rounded-pill">‚úì</span>
                                {% else %}
                                    <span class="badge bg-danger rounded-pill">‚úó</span>
                                {% endif %}
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                OPENAI_API_KEY
                                {% if env_vars.OPENAI_API_KEY %}
                                    <span class="badge bg-success rounded-pill">‚úì</span>
                                {% else %}
                                    <span class="badge bg-danger rounded-pill">‚úó</span>
                                {% endif %}
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">–õ–æ–≥–∏</h5>
                        <button class="btn btn-sm btn-outline-secondary" id="refreshLogsBtn">
                            <span class="spinner-border spinner-border-sm d-none" id="refreshSpinner" role="status"></span>
                            –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                    <div class="card-body p-0">
                        <div class="log-container p-3" id="logContainer">
                            {% for entry in bot_status.log %}
                                <div class="log-entry {{ entry.level }}">
                                    <span class="badge bg-secondary text-white status-badge">{{ entry.timestamp }}</span>
                                    <span class="badge bg-{% if entry.level == 'ERROR' %}danger{% elif entry.level == 'WARNING' %}warning{% else %}success{% endif %} text-white status-badge">{{ entry.level }}</span>
                                    <span>{{ entry.message }}</span>
                                </div>
                            {% else %}
                                <div class="text-center text-muted py-5">
                                    <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–æ–≥–æ–≤</p>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</h5>
                    </div>
                    <div class="card-body">
                        <p>–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º:</p>
                        <ol>
                            <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.</li>
                            <li>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É "–ó–∞–ø—É—Å—Ç–∏—Ç—å".</li>
                            <li>–û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ –ø–æ –∏–º–µ–Ω–∏.</li>
                            <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É –∫–æ–º–∞–Ω–¥—É /start –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã.</li>
                            <li>–ï—Å–ª–∏ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ —ç—Ç—É –ø–∞–Ω–µ–ª—å.</li>
                        </ol>
                        <p>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ "–õ–æ–≥–∏".</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            const restartBtn = document.getElementById('restartBtn');
            const refreshLogsBtn = document.getElementById('refreshLogsBtn');
            const refreshSpinner = document.getElementById('refreshSpinner');
            const logContainer = document.getElementById('logContainer');
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞
            function updateUI(status) {
                if (status.running) {
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
                } else {
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–æ–≥–æ–≤
            async function refreshLogs() {
                refreshSpinner.classList.remove('d-none');
                try {
                    const response = await fetch('/api/bot/logs');
                    const data = await response.json();
                    
                    if (data.logs && data.logs.length > 0) {
                        let logsHtml = '';
                        data.logs.forEach(entry => {
                            const bgClass = entry.level === 'ERROR' ? 'danger' : 
                                           entry.level === 'WARNING' ? 'warning' : 'success';
                            
                            logsHtml += `
                                <div class="log-entry ${entry.level}">
                                    <span class="badge bg-secondary text-white status-badge">${entry.timestamp}</span>
                                    <span class="badge bg-${bgClass} text-white status-badge">${entry.level}</span>
                                    <span>${entry.message}</span>
                                </div>
                            `;
                        });
                        logContainer.innerHTML = logsHtml;
                    } else {
                        logContainer.innerHTML = `
                            <div class="text-center text-muted py-5">
                                <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–æ–≥–æ–≤</p>
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ª–æ–≥–æ–≤:', error);
                } finally {
                    refreshSpinner.classList.add('d-none');
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞
            async function checkStatus() {
                try {
                    const response = await fetch('/api/bot/status');
                    const status = await response.json();
                    updateUI(status);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞:', error);
                }
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫
            startBtn.addEventListener('click', async function() {
                try {
                    await fetch('/api/bot/start');
                    setTimeout(() => {
                        checkStatus();
                        refreshLogs();
                    }, 1000);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞:', error);
                }
            });
            
            stopBtn.addEventListener('click', async function() {
                try {
                    await fetch('/api/bot/stop');
                    setTimeout(() => {
                        checkStatus();
                        refreshLogs();
                    }, 1000);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞:', error);
                }
            });
            
            restartBtn.addEventListener('click', async function() {
                try {
                    await fetch('/api/bot/restart');
                    setTimeout(() => {
                        checkStatus();
                        refreshLogs();
                    }, 1000);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞:', error);
                }
            });
            
            refreshLogsBtn.addEventListener('click', refreshLogs);
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏ –ª–æ–≥–æ–≤
            setInterval(checkStatus, 5000);
            setInterval(refreshLogs, 10000);
        });
    </script>
</body>
</html>