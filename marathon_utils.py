"""
–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –º–∞—Ä–∞—Ñ–æ–Ω–∞—Ö.
"""
import csv
import os
from typing import List, Dict

def get_marathons_list() -> List[Dict[str, str]]:
    """
    –ß–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –º–∞—Ä–∞—Ñ–æ–Ω–∞—Ö –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.
    
    Returns:
        List[Dict[str, str]]: –°–ø–∏—Å–æ–∫ –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤ —Å –ø–æ–ª—è–º–∏: –ù–∞–∑–≤–∞–Ω–∏–µ, –î–∞—Ç–∞, –ú–µ—Å—Ç–æ, –¢–∏–ø, –°–∞–π—Ç
    """
    marathons = []
    csv_path = os.path.join('data', 'marathons.csv')
    
    try:
        with open(csv_path, 'r', encoding='utf-8') as f:
            reader = csv.DictReader(f)
            for row in reader:
                marathons.append(row)
        return marathons
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤: {e}")
        return []

def format_marathon_info(marathon: Dict[str, str]) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞—Ä–∞—Ñ–æ–Ω–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
    
    Args:
        marathon: –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –º–∞—Ä–∞—Ñ–æ–Ω–µ
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
    """
    return (f"üèÉ *{marathon['–ù–∞–∑–≤–∞–Ω–∏–µ']}*\n"
            f"üìÖ –î–∞—Ç–∞: {marathon['–î–∞—Ç–∞']}\n"
            f"üìç –ú–µ—Å—Ç–æ: {marathon['–ú–µ—Å—Ç–æ']}\n"
            f"üèÅ –¢–∏–ø: {marathon['–¢–∏–ø']}\n"
            f"üåê [–°–∞–π—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è]({marathon['–°–∞–π—Ç']})")

def get_marathon_message_text() -> str:
    """
    –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ —Å–ø–∏—Å–∫–æ–º –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤.
    
    Returns:
        str: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –º–∞—Ä–∞—Ñ–æ–Ω–∞—Ö
    """
    marathons = get_marathons_list()
    if not marathons:
        return "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞—Ä–∞—Ñ–æ–Ω–∞—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞."
    
    message = "üìÖ *–ë–ª–∏–∂–∞–π—à–∏–µ –º–∞—Ä–∞—Ñ–æ–Ω—ã*\n\n"
    message += "–í–æ—Ç —Å–ø–∏—Å–æ–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–∞—Å –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞—Ç—å:\n\n"
    
    for i, marathon in enumerate(marathons[:5], 1):  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 5 –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤
        message += f"{i}. {format_marathon_info(marathon)}\n\n"
    
    message += "–í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –∏–∑ —ç—Ç–∏—Ö –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤ –∏–ª–∏ —É–∫–∞–∑–∞—Ç—å —Å–≤–æ—é –¥–∞—Ç—É –ø–æ–∑–∂–µ."
    
    return message